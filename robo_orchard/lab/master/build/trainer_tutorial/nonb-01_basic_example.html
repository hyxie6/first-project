<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="API Reference" href="../../api/index.html" /><link rel="prev" title="Trainer Tutorials" href="index.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Mastering Your Training Pipeline - RoboOrchard Lab</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-codeautolink.css?v=b2176991" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">RoboOrchard Lab</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/orchard_logo.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/orchard_logo.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">RoboOrchard Lab</span>
  
</a>
<meta name="current-version-id" content="master">

<meta name="versions-json-url" content="https://hyxie6.github.io/first-project/robo_orchard/lab/version.json">

<div id="version-selector-wrapper"
     style="visibility: hidden;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            padding: 0;
            margin: 8px 5px;
            display: inline-block;
            background-color: transparent;
            position: relative;">
    <select id="version-selector"
            style="padding: 6px 8px;
                   border: none;
                   background-color: transparent;
                   font-size: 0.9em;
                   display: block;
                   min-width: 140px;
                   width: 100%;
                   cursor: pointer;
                   text-align: center;
                   text-align-last: center;
                   line-height: 1.4;">
        <!-- Populated dynamically by JavaScript -->
    </select>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const wrapper = document.getElementById('version-selector-wrapper');
    const selector = document.getElementById('version-selector');
    const metaCurrentVersionIdTag = document.querySelector('meta[name="current-version-id"]');
    const actualCurrentVersionId = metaCurrentVersionIdTag ? metaCurrentVersionIdTag.content : null;
    const metaVersionsJsonUrlTag = document.querySelector('meta[name="versions-json-url"]');
    const versionsJsonUrl = metaVersionsJsonUrlTag ? metaVersionsJsonUrlTag.content : null;
    const versionsCacheKey = 'sphinxVersionsJsonCache_vHybrid';

    function populateSelector(versionsData) {
        if (!selector || !wrapper) return;
        selector.innerHTML = '';

        if (Array.isArray(versionsData) && versionsData.length > 0) {
            versionsData.forEach(version => {
                if (version && version.url && version.name && version.id) {
                    const option = document.createElement('option');
                    option.value = version.url;
                    option.textContent = version.name;
                    if (actualCurrentVersionId && version.id === actualCurrentVersionId) {
                        option.selected = true;
                    }
                    selector.appendChild(option);
                }
            });
        } else {
            const fallbackOption = document.createElement('option');
            fallbackOption.textContent = "No versions available";
            fallbackOption.disabled = true;
            selector.appendChild(fallbackOption);
            console.warn("versions.json was empty, not loaded, or invalid.");
        }
        wrapper.style.visibility = 'visible';
    }

    if (!versionsJsonUrl) {
        console.error("Cannot fetch versions: versions.json URL is missing.");
        populateSelector(null);
        return;
    }

    const cachedVersions = sessionStorage.getItem(versionsCacheKey);
    if (cachedVersions) {
        try {
            const versions = JSON.parse(cachedVersions);
            populateSelector(versions);
        } catch (e) {
            sessionStorage.removeItem(versionsCacheKey);
            fetchAndPopulate();
        }
    } else {
        fetchAndPopulate();
    }

    function fetchAndPopulate() {
        fetch(versionsJsonUrl)
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error fetching versions.json! Status: ${response.status}`);
                return response.json();
            })
            .then(versions => {
                sessionStorage.setItem(versionsCacheKey, JSON.stringify(versions));
                populateSelector(versions);
            })
            .catch(error => {
                console.error('Failed to load or parse versions.json:', error);
                populateSelector(null);
            });
    }

    if (selector) {
        selector.addEventListener('change', function() {
            if (this.value) window.location.href = this.value;
        });
    }
});
</script><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../model_zoo/index.html">Model Zoo</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Model Zoo</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../model_zoo/perception/index.html">Perception</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Perception</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../model_zoo/perception/bip3d.html">BIP3D: Bridging 2D Images and 3D Perception for Embodied Intelligence</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Trainer Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Trainer Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Mastering Your Training Pipeline</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/dataset/index.html">dataset</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of dataset</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/dataset/embodiedscan.html">Embediedscan</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/models/index.html">models</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/models/layers.html">Layers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/models/modules.html">Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/models/bip3d.html">BIP3D</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/pipeline/index.html">pipeline</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of pipeline</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/pipeline/trainer.html">trainer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/pipeline/batch_processor.html">batch processor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/pipeline/hooks.html">hooks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/utils/index.html">utils</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/build/trainer_tutorial/nonb-01_basic_example.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-build-trainer-tutorial-nonb-01-basic-example-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="mastering-your-training-pipeline">
<span id="sphx-glr-build-trainer-tutorial-nonb-01-basic-example-py"></span><h1>Mastering Your Training Pipeline<a class="headerlink" href="#mastering-your-training-pipeline" title="Link to this heading">¶</a></h1>
<section id="prerequest-import-packages-and-configure-logging">
<h2>Prerequest: Import packages and configure logging<a class="headerlink" href="#prerequest-import-packages-and-configure-logging" title="Link to this heading">¶</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Any" title="typing.Any" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-data"><span class="n">Any</span></a><span class="p">,</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="typing.Optional" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-data"><span class="n">Optional</span></a><span class="p">,</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="typing.Tuple" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-data"><span class="n">Tuple</span></a>

<span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">robo_orchard_lab.utils</span> <span class="kn">import</span> <span class="n">log_basic_config</span>

<span class="n">log_basic_config</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><a href="https://docs.python.org/3.10/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span></a><span class="p">)</span>
<a href="https://docs.python.org/3.10/library/logging.html#logging.Logger" title="logging.Logger" class="sphx-glr-backref-module-logging sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">logger</span></a> <span class="o">=</span> <a href="https://docs.python.org/3.10/library/logging.html#logging.getLogger" title="logging.getLogger" class="sphx-glr-backref-module-logging sphx-glr-backref-type-py-function"><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span></a><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="part1-using-pydantic-for-configuration">
<h2>Part1: Using pydantic for configuration<a class="headerlink" href="#part1-using-pydantic-for-configuration" title="Link to this heading">¶</a></h2>
<p>Our framework emphasizes configuration-driven training. Let’s look at DatasetConfig</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <a href="https://docs.pydantic.dev/api/fields/#pydantic.fields.Field" title="pydantic.Field" class="sphx-glr-backref-module-pydantic sphx-glr-backref-type-py-function"><span class="n">Field</span></a>
<span class="kn">from</span> <span class="nn">robo_orchard_core.utils.cli</span> <span class="kn">import</span> <a href="https://docs.pydantic.dev/api/pydantic_settings/#pydantic_settings.BaseSettings" title="pydantic_settings.BaseSettings" class="sphx-glr-backref-module-pydantic_settings sphx-glr-backref-type-py-class"><span class="n">SettingConfig</span></a>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader" title="torch.utils.data.DataLoader" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">DataLoader</span></a><span class="p">,</span> <a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.Dataset" title="torch.utils.data.Dataset" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">Dataset</span></a>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">transforms</span>


<span class="k">class</span> <span class="nc">DatasetConfig</span><span class="p">(</span><a href="https://docs.pydantic.dev/api/pydantic_settings/#pydantic_settings.BaseSettings" title="pydantic_settings.BaseSettings" class="sphx-glr-backref-module-pydantic_settings sphx-glr-backref-type-py-class"><span class="n">SettingConfig</span></a><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for the dataset.</span>

<span class="sd">    This is a example configuration for the ImageNet dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data_root</span><span class="p">:</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="typing.Optional" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-data"><span class="n">Optional</span></a><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <a href="https://docs.pydantic.dev/api/fields/#pydantic.fields.Field" title="pydantic.Field" class="sphx-glr-backref-module-pydantic sphx-glr-backref-type-py-function"><span class="n">Field</span></a><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Image dataset directory.&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">pipeline_test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <a href="https://docs.pydantic.dev/api/fields/#pydantic.fields.Field" title="pydantic.Field" class="sphx-glr-backref-module-pydantic sphx-glr-backref-type-py-function"><span class="n">Field</span></a><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Whether or not use dummy data for fast pipeline test.&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">dummy_train_imgs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <a href="https://docs.pydantic.dev/api/fields/#pydantic.fields.Field" title="pydantic.Field" class="sphx-glr-backref-module-pydantic sphx-glr-backref-type-py-function"><span class="n">Field</span></a><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Number of dummy training images.&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">dummy_val_imgs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <a href="https://docs.pydantic.dev/api/fields/#pydantic.fields.Field" title="pydantic.Field" class="sphx-glr-backref-module-pydantic sphx-glr-backref-type-py-function"><span class="n">Field</span></a><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Number of dummy validation images.&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_test</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;data_root must be specified when pipeline_test is False.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="typing.Tuple" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-data"><span class="n">Tuple</span></a><span class="p">[</span><a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.Dataset" title="torch.utils.data.Dataset" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">Dataset</span></a><span class="p">,</span> <a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.Dataset" title="torch.utils.data.Dataset" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">Dataset</span></a><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_test</span><span class="p">:</span>
            <span class="n">train_dataset</span> <span class="o">=</span> <a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.Dataset" title="torch.utils.data.Dataset" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">datasets</span><span class="o">.</span><span class="n">FakeData</span></a><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dummy_train_imgs</span><span class="p">,</span>
                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">),</span>
                <span class="mi">1000</span><span class="p">,</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">val_dataset</span> <span class="o">=</span> <a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.Dataset" title="torch.utils.data.Dataset" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">datasets</span><span class="o">.</span><span class="n">FakeData</span></a><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dummy_val_imgs</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">),</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_root</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">train_dataset</span> <span class="o">=</span> <a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.Dataset" title="torch.utils.data.Dataset" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">datasets</span><span class="o">.</span><span class="n">ImageFolder</span></a><span class="p">(</span>
                <a href="https://docs.python.org/3.10/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_root</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">),</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
                    <span class="p">[</span>
                        <a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">transforms</span><span class="o">.</span><span class="n">RandomResizedCrop</span></a><span class="p">(</span><span class="mi">224</span><span class="p">),</span>
                        <a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">transforms</span><span class="o">.</span><span class="n">RandomHorizontalFlip</span></a><span class="p">(),</span>
                        <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
                        <a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span></a><span class="p">(</span>
                            <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">],</span>
                            <span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">],</span>
                        <span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">),</span>
            <span class="p">)</span>

            <span class="n">val_dataset</span> <span class="o">=</span> <a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.Dataset" title="torch.utils.data.Dataset" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">datasets</span><span class="o">.</span><span class="n">ImageFolder</span></a><span class="p">(</span>
                <a href="https://docs.python.org/3.10/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_root</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">),</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
                    <span class="p">[</span>
                        <a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span></a><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
                        <a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">transforms</span><span class="o">.</span><span class="n">CenterCrop</span></a><span class="p">(</span><span class="mi">224</span><span class="p">),</span>
                        <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
                        <a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span></a><span class="p">(</span>
                            <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">],</span>
                            <span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">],</span>
                        <span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">train_dataset</span><span class="p">,</span> <span class="n">val_dataset</span>
</pre></div>
</div>
<p>DatasetConfig uses Pydantic Field to define parameters like data_root and pipeline_test.
The pipeline_test flag is crucial. If True, it uses FakeData for a quick test run without needing the actual ImageNet dataset.
get_dataset() method encapsulates the logic for creating train and validation datasets.</p>
<p>TrainerConfig, which nests DatasetConfig:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TrainerConfig</span><span class="p">(</span><a href="https://docs.pydantic.dev/api/pydantic_settings/#pydantic_settings.BaseSettings" title="pydantic_settings.BaseSettings" class="sphx-glr-backref-module-pydantic_settings sphx-glr-backref-type-py-class"><span class="n">SettingConfig</span></a><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for the trainer.</span>

<span class="sd">    This is an example configuration for training a ResNet50 model</span>
<span class="sd">    on ImageNet. Only a few parameters are set here for demonstration</span>
<span class="sd">    purposes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dataset</span><span class="p">:</span> <a href="https://docs.pydantic.dev/api/pydantic_settings/#pydantic_settings.BaseSettings" title="pydantic_settings.BaseSettings" class="sphx-glr-backref-module-pydantic_settings sphx-glr-backref-type-py-class"><span class="n">DatasetConfig</span></a> <span class="o">=</span> <a href="https://docs.pydantic.dev/api/fields/#pydantic.fields.Field" title="pydantic.Field" class="sphx-glr-backref-module-pydantic sphx-glr-backref-type-py-function"><span class="n">Field</span></a><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Dataset configuration. Need to be set by user.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <a href="https://docs.pydantic.dev/api/fields/#pydantic.fields.Field" title="pydantic.Field" class="sphx-glr-backref-module-pydantic sphx-glr-backref-type-py-function"><span class="n">Field</span></a><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Batch size for training.&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <a href="https://docs.pydantic.dev/api/fields/#pydantic.fields.Field" title="pydantic.Field" class="sphx-glr-backref-module-pydantic sphx-glr-backref-type-py-function"><span class="n">Field</span></a><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Number of workers for data loading.&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">max_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <a href="https://docs.pydantic.dev/api/fields/#pydantic.fields.Field" title="pydantic.Field" class="sphx-glr-backref-module-pydantic sphx-glr-backref-type-py-function"><span class="n">Field</span></a><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Maximum number of epochs for training.&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">workspace_root</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <a href="https://docs.pydantic.dev/api/fields/#pydantic.fields.Field" title="pydantic.Field" class="sphx-glr-backref-module-pydantic sphx-glr-backref-type-py-function"><span class="n">Field</span></a><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Workspace root directory.&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;./workspace/&quot;</span><span class="p">,</span>
    <span class="p">)</span>


<span class="n">cfg</span> <span class="o">=</span> <a href="https://docs.pydantic.dev/api/pydantic_settings/#pydantic_settings.BaseSettings" title="pydantic_settings.BaseSettings" class="sphx-glr-backref-module-pydantic_settings sphx-glr-backref-type-py-class"><span class="n">TrainerConfig</span></a><span class="p">(</span>
    <span class="n">dataset</span><span class="o">=</span><a href="https://docs.pydantic.dev/api/pydantic_settings/#pydantic_settings.BaseSettings" title="pydantic_settings.BaseSettings" class="sphx-glr-backref-module-pydantic_settings sphx-glr-backref-type-py-class"><span class="n">DatasetConfig</span></a><span class="p">(</span><span class="n">pipeline_test</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">max_epoch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
<p>These Pydantic models can also parsed from command-line arguments using <code class="docutils literal notranslate"><span class="pre">pydantic_from_argparse(TrainerConfig,</span> <span class="pre">parser)</span></code>. This means you can override any setting from the CLI, e.g., <code class="docutils literal notranslate"><span class="pre">--batch_size</span> <span class="pre">64</span></code> or even nested ones like <code class="docutils literal notranslate"><span class="pre">--dataset.data_root</span> <span class="pre">/path/to/my/data</span></code>.</p>
</section>
<section id="part2-understanding-the-core-trainer-components">
<h2>Part2: Understanding the Core trainer Components<a class="headerlink" href="#part2-understanding-the-core-trainer-components" title="Link to this heading">¶</a></h2>
<p>Let’s dive into the specific components from robo_orchard_lab that make this work.</p>
<section id="accelerator-the-engine-for-scale-and-simplicity">
<h3>Accelerator: The Engine for Scale and Simplicity<a class="headerlink" href="#accelerator-the-engine-for-scale-and-simplicity" title="Link to this heading">¶</a></h3>
<p>Accelerator from Hugging Face handles:</p>
<ul class="simple">
<li><p>Device Agnosticism: Runs your code on CPU, single GPU, multiple GPUs, or TPUs with minimal changes.</p></li>
<li><p>Distributed Training: Automatically sets up distributed training if multiple GPUs are available.</p></li>
<li><p>Mixed Precision: Can enable AMP for faster training and reduced memory.</p></li>
<li><p>Checkpointing: Accelerator manage saving and loading checkpoints in an organized way.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">accelerate</span> <span class="kn">import</span> <span class="n">Accelerator</span>
<span class="kn">from</span> <span class="nn">accelerate.utils</span> <span class="kn">import</span> <span class="n">ProjectConfiguration</span>

<span class="n">accelerator</span> <span class="o">=</span> <span class="n">Accelerator</span><span class="p">(</span>
    <span class="n">project_config</span><span class="o">=</span><span class="n">ProjectConfiguration</span><span class="p">(</span>
        <span class="n">project_dir</span><span class="o">=</span><a href="https://docs.python.org/3.10/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cfg</span><span class="o">.</span><span class="n">workspace_root</span></a><span class="p">,</span>
        <span class="n">logging_dir</span><span class="o">=</span><a href="https://docs.python.org/3.10/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3.10/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cfg</span><span class="o">.</span><span class="n">workspace_root</span></a><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">),</span>
        <span class="n">automatic_checkpoint_naming</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">total_limit</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>  <span class="c1"># Max checkpoints to keep</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="batch-processor-defining-per-step-logic">
<h3>Batch processor: Defining Per-Step Logic<a class="headerlink" href="#batch-processor-defining-per-step-logic" title="Link to this heading">¶</a></h3>
<p>Instead of hard coding the forward pass and loss calculation within the trainer, we use a BatchProcessor.
MyBatchProcessor inherits from <a class="reference internal" href="../../api/pipeline/batch_processor.html#robo_orchard_lab.pipeline.batch_processor.simple.SimpleBatchProcessor" title="robo_orchard_lab.pipeline.batch_processor.simple.SimpleBatchProcessor"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.batch_processor.simple.SimpleBatchProcessor</span></code></a>.</p>
<p>You define your loss function (here, CrossEntropyLoss) in <code class="docutils literal notranslate"><span class="pre">__init__</span></code>.
<code class="docutils literal notranslate"><span class="pre">forward</span></code> contains the logic for a single step: getting model output and calculating loss.
The need_backward flag allows this processor to be used for evaluation loops where backpropagation isn’t needed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Accelerator handles moving the model and batch to the correct device before forward is called by the trainer.</p>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">robo_orchard_lab.pipeline.batch_processor</span> <span class="kn">import</span> <a href="https://docs.python.org/3.10/library/abc.html#abc.ABC" title="abc.ABC" class="sphx-glr-backref-module-abc sphx-glr-backref-type-py-class"><span class="n">SimpleBatchProcessor</span></a>


<span class="k">class</span> <span class="nc">MyBatchProcessor</span><span class="p">(</span><a href="https://docs.python.org/3.10/library/abc.html#abc.ABC" title="abc.ABC" class="sphx-glr-backref-module-abc sphx-glr-backref-type-py-class"><span class="n">SimpleBatchProcessor</span></a><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span> <span class="o">=</span> <a href="https://pytorch.org/docs/stable/generated/torch.nn.CrossEntropyLoss.html#torch.nn.CrossEntropyLoss" title="torch.nn.CrossEntropyLoss" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span></a><span class="p">()</span>  <span class="c1"># Define your loss</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span></a><span class="p">,</span>
        <span class="n">batch</span><span class="p">:</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="typing.Tuple" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-data"><span class="n">Tuple</span></a><span class="p">[</span><a href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class"><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></a><span class="p">,</span> <a href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class"><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></a><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Tuple" title="typing.Tuple" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-data"><span class="n">Tuple</span></a><span class="p">[</span><a href="https://docs.python.org/3.10/library/typing.html#typing.Any" title="typing.Any" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-data"><span class="n">Any</span></a><span class="p">,</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Optional" title="typing.Optional" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-data"><span class="n">Optional</span></a><span class="p">[</span><a href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class"><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></a><span class="p">]]:</span>
        <span class="c1"># unpack batch by yourself</span>
        <span class="n">images</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">batch</span>

        <span class="c1"># Accelerator has already moved batch to the correct device</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_backward</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">loss</span>  <span class="c1"># Returns model output and loss</span>
</pre></div>
</div>
</section>
<section id="hooks-customizing-your-pipeline">
<h3>Hooks: Customizing your pipeline<a class="headerlink" href="#hooks-customizing-your-pipeline" title="Link to this heading">¶</a></h3>
<p>Hooks are the primary way to add custom behavior to the training or evaluation loop without modifying its source code.
They are called at specific points during training or evaluation (e.g., end of epoch, after a step).</p>
<p>Core Concepts of the <code class="docutils literal notranslate"><span class="pre">PipelineHooks</span></code> System</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.mixin.PipelineHookArgs" title="robo_orchard_lab.pipeline.hooks.mixin.PipelineHookArgs"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.mixin.PipelineHookArgs</span></code></a>: A dataclass holding all relevant information (accelerator,
epoch/step IDs, batch data, model outputs, loss, etc.) passed to each hook.
This ensures hooks have a standardized, type-safe context.</p></li>
<li><p><a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.mixin.PipelineHooksConfig" title="robo_orchard_lab.pipeline.hooks.mixin.PipelineHooksConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.mixin.PipelineHooksConfig</span></code></a>: The entire <a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.mixin.PipelineHooks" title="robo_orchard_lab.pipeline.hooks.mixin.PipelineHooks"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.mixin.PipelineHooks</span></code></a> setup,
including which individual hooks are active and their parameters, can often be defined via Pydantic configurations.
This offers great flexibility and reproducibility. For instance, a main
experiment config might point to a <a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.mixin.PipelineHooksConfig" title="robo_orchard_lab.pipeline.hooks.mixin.PipelineHooksConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.mixin.PipelineHooksConfig</span></code></a>,
which in turn might specify a list of individual hook configurations (e.g.,
<a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.metric.MetricTrackerConfig" title="robo_orchard_lab.pipeline.hooks.metric.MetricTrackerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.metric.MetricTrackerConfig</span></code></a>,
<a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.checkpoint.SaveCheckpointConfig" title="robo_orchard_lab.pipeline.hooks.checkpoint.SaveCheckpointConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.checkpoint.SaveCheckpointConfig</span></code></a>).</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3.10/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hooks</span></a> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<section id="metrictracker-track-on-performance">
<h4>MetricTracker: Track on performance<a class="headerlink" href="#metrictracker-track-on-performance" title="Link to this heading">¶</a></h4>
<p><a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.metric.MetricTracker" title="robo_orchard_lab.pipeline.hooks.metric.MetricTracker"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.metric.MetricTracker</span></code></a> is a specialized hook for handling metrics.
It takes a list of <a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.metric.MetricEntry" title="robo_orchard_lab.pipeline.hooks.metric.MetricEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.metric.MetricEntry</span></code></a> objects. Each MetricEntry defines:</p>
<ul class="simple">
<li><p>names: How the metric will be logged.</p></li>
<li><p>metric: An instance of a torchmetrics metric (or any compatible metric object).</p></li>
</ul>
<p><a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.metric.MetricTracker" title="robo_orchard_lab.pipeline.hooks.metric.MetricTracker"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.metric.MetricTracker</span></code></a> is an abstarct class, you should inherit it
and implement the <a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.metric.MetricTracker.update_metric" title="robo_orchard_lab.pipeline.hooks.metric.MetricTracker.update_metric"><code class="xref py py-meth docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.metric.MetricTracker.update_metric()</span></code></a> method, which is called by the trainer to update these metrics with batch outputs and targets.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torchmetrics</span> <span class="kn">import</span> <span class="n">Accuracy</span> <span class="k">as</span> <a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">AccuracyMetric</span></a>

<span class="kn">from</span> <span class="nn">robo_orchard_lab.pipeline.hooks</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">MetricEntry</span><span class="p">,</span>
    <span class="n">MetricTracker</span><span class="p">,</span>
    <a href="https://docs.python.org/3.10/library/typing.html#typing.Generic" title="typing.Generic" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-class"><span class="n">MetricTrackerConfig</span></a><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">MyMetricTracker</span><span class="p">(</span><span class="n">MetricTracker</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">update_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Any" title="typing.Any" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-data"><span class="n">Any</span></a><span class="p">,</span> <span class="n">model_outputs</span><span class="p">:</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Any" title="typing.Any" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-data"><span class="n">Any</span></a><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">batch</span>
        <span class="k">for</span> <span class="n">metric_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
            <span class="n">metric_i</span><span class="p">(</span><span class="n">model_outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyMetricTrackerConfig</span><span class="p">(</span><a href="https://docs.python.org/3.10/library/typing.html#typing.Generic" title="typing.Generic" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-class"><span class="n">MetricTrackerConfig</span></a><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An example metric tracker config.&quot;&quot;&quot;</span>

    <span class="c1"># note: bind MyMetricTracker</span>
    <span class="n">class_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">MyMetricTracker</span><span class="p">]</span> <span class="o">=</span> <span class="n">MyMetricTracker</span>


<span class="n">metric_tracker</span> <span class="o">=</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Generic" title="typing.Generic" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-class"><span class="n">MyMetricTrackerConfig</span></a><span class="p">(</span>
    <span class="n">metric_entrys</span><span class="o">=</span><span class="p">[</span>
        <span class="n">MetricEntry</span><span class="p">(</span>
            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;top1_acc&quot;</span><span class="p">],</span>
            <span class="n">metric</span><span class="o">=</span><a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">AccuracyMetric</span></a><span class="p">(</span>
                <span class="n">task</span><span class="o">=</span><span class="s2">&quot;multiclass&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="n">MetricEntry</span><span class="p">(</span>
            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;top5_acc&quot;</span><span class="p">],</span>
            <span class="n">metric</span><span class="o">=</span><a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">AccuracyMetric</span></a><span class="p">(</span>
                <span class="n">task</span><span class="o">=</span><span class="s2">&quot;multiclass&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">],</span>
    <span class="n">step_log_freq</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">log_main_process_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<a href="https://docs.python.org/3.10/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hooks</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric_tracker</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="statsmonitor-logging-training-vitals">
<h4>StatsMonitor: Logging Training Vitals<a class="headerlink" href="#statsmonitor-logging-training-vitals" title="Link to this heading">¶</a></h4>
<p><a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.stats.StatsMonitor" title="robo_orchard_lab.pipeline.hooks.stats.StatsMonitor"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.stats.StatsMonitor</span></code></a> monitors and logs statistics like learning rate, training speed (samples/sec), estimated time remaining, etc.
Its <code class="docutils literal notranslate"><span class="pre">step_log_freq</span></code> controls how often this information is printed or logged.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">robo_orchard_lab.pipeline.hooks</span> <span class="kn">import</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Generic" title="typing.Generic" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-class"><span class="n">StatsMonitorConfig</span></a>

<span class="n">stats</span> <span class="o">=</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Generic" title="typing.Generic" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-class"><span class="n">StatsMonitorConfig</span></a><span class="p">(</span><span class="n">step_log_freq</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>

<a href="https://docs.python.org/3.10/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hooks</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="savecheckpoint-saving-your-progress">
<h4>SaveCheckpoint: Saving Your Progress<a class="headerlink" href="#savecheckpoint-saving-your-progress" title="Link to this heading">¶</a></h4>
<p><a class="reference internal" href="../../api/pipeline/hooks.html#robo_orchard_lab.pipeline.hooks.checkpoint.SaveCheckpointConfig" title="robo_orchard_lab.pipeline.hooks.checkpoint.SaveCheckpointConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hooks.checkpoint.SaveCheckpointConfig</span></code></a> is responsible for triggering model checkpoint saves.
It calls <code class="xref py py-class docutils literal notranslate"><span class="pre">acclerator.Accelerator.save_state()`</span></code> internally. <code class="docutils literal notranslate"><span class="pre">save_step_freq</span></code> defines how many training steps between checkpoints.
Resuming is handled by Accelerator</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">robo_orchard_lab.pipeline.hooks</span> <span class="kn">import</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Generic" title="typing.Generic" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-class"><span class="n">SaveCheckpointConfig</span></a>

<span class="n">save_checkpoint</span> <span class="o">=</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Generic" title="typing.Generic" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-class"><span class="n">SaveCheckpointConfig</span></a><span class="p">(</span><span class="n">save_step_freq</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>

<a href="https://docs.python.org/3.10/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hooks</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">save_checkpoint</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="advanced-creating-your-first-custom-hook">
<h4>(Advanced) Creating Your First Custom Hook<a class="headerlink" href="#advanced-creating-your-first-custom-hook" title="Link to this heading">¶</a></h4>
<p>In many complex training scenarios, you might need to inject custom logic at various
points within the training loop (e.g., at the beginning/end of an epoch, or before/after
a training step). The <code class="docutils literal notranslate"><span class="pre">robo_orchard_lab</span></code> framework provides a powerful and flexible
Hook system based on <code class="docutils literal notranslate"><span class="pre">PipelineHooks</span></code> to achieve this without modifying the core
training engine.</p>
<p>This tutorial will guide you through:
1. Understanding the core components: <code class="docutils literal notranslate"><span class="pre">PipelineHooksConfig</span></code>, <code class="docutils literal notranslate"><span class="pre">PipelineHooks</span></code>, <code class="docutils literal notranslate"><span class="pre">HookContext</span></code>, and <code class="docutils literal notranslate"><span class="pre">PipelineHookArgs</span></code>.
2. Creating a custom hook class that bundles logging logic for different training stages.
3. Configuring and instantiating your custom hook.
4. (Simulated) Seeing how this hook would interact with a training engine.</p>
<p>Let’s get started!</p>
<section id="implementing-the-custom-hook-myhook">
<h5>Implementing the Custom Hook: <code class="docutils literal notranslate"><span class="pre">MyHook</span></code><a class="headerlink" href="#implementing-the-custom-hook-myhook" title="Link to this heading">¶</a></h5>
<p>Let’s define <code class="docutils literal notranslate"><span class="pre">MyHook</span></code>. It inherits from <code class="docutils literal notranslate"><span class="pre">PipelineHooks</span></code>.
In its <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method, it takes its configuration (<code class="docutils literal notranslate"><span class="pre">MyHookConfig</span></code>)
and registers its own internal methods as callbacks to different channels
using <code class="docutils literal notranslate"><span class="pre">self.register_hook()</span></code> and <code class="docutils literal notranslate"><span class="pre">HookContext.from_callable()</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">HookContext.from_callable(before=...,</span> <span class="pre">after=...)</span></code> is a convenient way to create
a <code class="docutils literal notranslate"><span class="pre">HookContext</span></code> object where its <code class="docutils literal notranslate"><span class="pre">on_enter</span></code> method will call the <code class="docutils literal notranslate"><span class="pre">before</span></code>
function, and its <code class="docutils literal notranslate"><span class="pre">on_exit</span></code> method will call the <code class="docutils literal notranslate"><span class="pre">after</span></code> function.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">robo_orchard_lab.pipeline.hooks.mixin</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">HookContext</span><span class="p">,</span>
    <span class="n">PipelineHookArgs</span><span class="p">,</span>
    <span class="n">PipelineHooks</span><span class="p">,</span>
    <a href="https://docs.python.org/3.10/library/typing.html#typing.Generic" title="typing.Generic" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-class"><span class="n">PipelineHooksConfig</span></a><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">MyHook</span><span class="p">(</span><span class="n">PipelineHooks</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A custom hook that logs messages at the beginning and end of loops, epochs, and steps, based on configured frequencies.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="s2">&quot;MyHookConfig&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>

        <span class="c1"># Register loop-level hooks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_hook</span><span class="p">(</span>
            <span class="n">channel</span><span class="o">=</span><span class="s2">&quot;on_loop&quot;</span><span class="p">,</span>
            <span class="n">hook</span><span class="o">=</span><span class="n">HookContext</span><span class="o">.</span><span class="n">from_callable</span><span class="p">(</span>
                <span class="n">before</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_loop_begin</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_loop_end</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Register step-level hooks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_hook</span><span class="p">(</span>
            <span class="n">channel</span><span class="o">=</span><span class="s2">&quot;on_step&quot;</span><span class="p">,</span>
            <span class="n">hook</span><span class="o">=</span><span class="n">HookContext</span><span class="o">.</span><span class="n">from_callable</span><span class="p">(</span>
                <span class="n">before</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_step_begin</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_step_end</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Register epoch-level hooks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_hook</span><span class="p">(</span>
            <span class="n">channel</span><span class="o">=</span><span class="s2">&quot;on_epoch&quot;</span><span class="p">,</span>
            <span class="n">hook</span><span class="o">=</span><span class="n">HookContext</span><span class="o">.</span><span class="n">from_callable</span><span class="p">(</span>
                <span class="n">before</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_epoch_begin</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_epoch_end</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <a href="https://docs.python.org/3.10/library/logging.html#logging.Logger.info" title="logging.Logger.info" class="sphx-glr-backref-module-logging sphx-glr-backref-type-py-method"><span class="n">logger</span><span class="o">.</span><span class="n">info</span></a><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MyHook instance created with step_freq=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">log_step_freq</span><span class="si">}</span><span class="s2">, epoch_freq=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">log_epoch_freq</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_loop_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">PipelineHookArgs</span><span class="p">):</span>
        <a href="https://docs.python.org/3.10/library/logging.html#logging.Logger.info" title="logging.Logger.info" class="sphx-glr-backref-module-logging sphx-glr-backref-type-py-method"><span class="n">logger</span><span class="o">.</span><span class="n">info</span></a><span class="p">(</span><span class="s2">&quot;Begining loop&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_loop_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">PipelineHookArgs</span><span class="p">):</span>
        <a href="https://docs.python.org/3.10/library/logging.html#logging.Logger.info" title="logging.Logger.info" class="sphx-glr-backref-module-logging sphx-glr-backref-type-py-method"><span class="n">logger</span><span class="o">.</span><span class="n">info</span></a><span class="p">(</span><span class="s2">&quot;Ended loop&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_step_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">PipelineHookArgs</span><span class="p">):</span>
        <span class="c1"># Note: step_id is 0-indexed. Adding 1 for 1-indexed frequency check.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">step_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">log_step_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <a href="https://docs.python.org/3.10/library/logging.html#logging.Logger.info" title="logging.Logger.info" class="sphx-glr-backref-module-logging sphx-glr-backref-type-py-method"><span class="n">logger</span><span class="o">.</span><span class="n">info</span></a><span class="p">(</span><span class="s2">&quot;Begining </span><span class="si">{}</span><span class="s2">-th step&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">step_id</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_on_step_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">PipelineHookArgs</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">step_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">log_step_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <a href="https://docs.python.org/3.10/library/logging.html#logging.Logger.info" title="logging.Logger.info" class="sphx-glr-backref-module-logging sphx-glr-backref-type-py-method"><span class="n">logger</span><span class="o">.</span><span class="n">info</span></a><span class="p">(</span><span class="s2">&quot;Ended </span><span class="si">{}</span><span class="s2">-th step&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">step_id</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_on_epoch_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">PipelineHookArgs</span><span class="p">):</span>
        <span class="c1"># Note: epoch_id is 0-indexed. Adding 1 for 1-indexed frequency check.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">epoch_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">log_epoch_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <a href="https://docs.python.org/3.10/library/logging.html#logging.Logger.info" title="logging.Logger.info" class="sphx-glr-backref-module-logging sphx-glr-backref-type-py-method"><span class="n">logger</span><span class="o">.</span><span class="n">info</span></a><span class="p">(</span><span class="s2">&quot;Begining </span><span class="si">{}</span><span class="s2">-th epoch&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">epoch_id</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_on_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">PipelineHookArgs</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">epoch_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">log_epoch_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <a href="https://docs.python.org/3.10/library/logging.html#logging.Logger.info" title="logging.Logger.info" class="sphx-glr-backref-module-logging sphx-glr-backref-type-py-method"><span class="n">logger</span><span class="o">.</span><span class="n">info</span></a><span class="p">(</span><span class="s2">&quot;Ended </span><span class="si">{}</span><span class="s2">-th epoch&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">epoch_id</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="defining-your-custom-hook-configuration">
<h5>Defining Your Custom Hook Configuration<a class="headerlink" href="#defining-your-custom-hook-configuration" title="Link to this heading">¶</a></h5>
<p>Then, we define a Pydantic configuration class for our custom hook.
This class will inherit from <code class="docutils literal notranslate"><span class="pre">PipelineHooksConfig</span></code> and specify our custom hook
class as its <code class="docutils literal notranslate"><span class="pre">class_type</span></code>. It will also hold any parameters our hook needs,
like logging frequencies.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyHookConfig</span><span class="p">(</span><a href="https://docs.python.org/3.10/library/typing.html#typing.Generic" title="typing.Generic" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-class"><span class="n">PipelineHooksConfig</span></a><span class="p">[</span><span class="n">MyHook</span><span class="p">]):</span>
    <span class="n">class_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">MyHook</span><span class="p">]</span> <span class="o">=</span> <span class="n">MyHook</span>
    <span class="n">log_step_freq</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">log_epoch_freq</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>


<span class="n">my_hook</span> <span class="o">=</span> <a href="https://docs.python.org/3.10/library/typing.html#typing.Generic" title="typing.Generic" class="sphx-glr-backref-module-typing sphx-glr-backref-type-py-class"><span class="n">MyHookConfig</span></a><span class="p">()</span>

<a href="https://docs.python.org/3.10/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hooks</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">my_hook</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="dataloader-model-optimizer-and-learning-rate-scheduler">
<h3>DataLoader, model, optimizer and learning rate scheduler<a class="headerlink" href="#dataloader-model-optimizer-and-learning-rate-scheduler" title="Link to this heading">¶</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch.optim</span> <span class="kn">import</span> <a href="https://pytorch.org/docs/stable/generated/torch.optim.SGD.html#torch.optim.SGD" title="torch.optim.SGD" class="sphx-glr-backref-module-torch-optim sphx-glr-backref-type-py-class"><span class="n">SGD</span></a>
<span class="kn">from</span> <span class="nn">torch.optim.lr_scheduler</span> <span class="kn">import</span> <a href="https://pytorch.org/docs/stable/generated/torch.optim.lr_scheduler.StepLR.html#torch.optim.lr_scheduler.StepLR" title="torch.optim.lr_scheduler.StepLR" class="sphx-glr-backref-module-torch-optim-lr_scheduler sphx-glr-backref-type-py-class"><span class="n">StepLR</span></a>

<span class="n">train_dataset</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">()</span>
<a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader" title="torch.utils.data.DataLoader" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">train_dataloader</span></a> <span class="o">=</span> <a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader" title="torch.utils.data.DataLoader" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">DataLoader</span></a><span class="p">(</span>
    <span class="n">train_dataset</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><a href="https://docs.python.org/3.10/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cfg</span><span class="o">.</span><span class="n">batch_size</span></a><span class="p">,</span>
    <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><a href="https://docs.python.org/3.10/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cfg</span><span class="o">.</span><span class="n">num_workers</span></a><span class="p">,</span>
    <span class="n">pin_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet50</span><span class="p">()</span>

<a href="https://pytorch.org/docs/stable/generated/torch.optim.SGD.html#torch.optim.SGD" title="torch.optim.SGD" class="sphx-glr-backref-module-torch-optim sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">optimizer</span></a> <span class="o">=</span> <a href="https://pytorch.org/docs/stable/generated/torch.optim.SGD.html#torch.optim.SGD" title="torch.optim.SGD" class="sphx-glr-backref-module-torch-optim sphx-glr-backref-type-py-class"><span class="n">SGD</span></a><span class="p">(</span><a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module.parameters" title="torch.nn.Module.parameters" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-method"><span class="n">model</span><span class="o">.</span><span class="n">parameters</span></a><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<a href="https://pytorch.org/docs/stable/generated/torch.optim.lr_scheduler.StepLR.html#torch.optim.lr_scheduler.StepLR" title="torch.optim.lr_scheduler.StepLR" class="sphx-glr-backref-module-torch-optim-lr_scheduler sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">lr_scheduler</span></a> <span class="o">=</span> <a href="https://pytorch.org/docs/stable/generated/torch.optim.lr_scheduler.StepLR.html#torch.optim.lr_scheduler.StepLR" title="torch.optim.lr_scheduler.StepLR" class="sphx-glr-backref-module-torch-optim-lr_scheduler sphx-glr-backref-type-py-class"><span class="n">StepLR</span></a><span class="p">(</span><a href="https://pytorch.org/docs/stable/generated/torch.optim.SGD.html#torch.optim.SGD" title="torch.optim.SGD" class="sphx-glr-backref-module-torch-optim sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">optimizer</span></a><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="part3-orchestrating-the-training">
<h2>Part3: Orchestrating the Training<a class="headerlink" href="#part3-orchestrating-the-training" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="../../api/pipeline/trainer.html#robo_orchard_lab.pipeline.hook_based_trainer.HookBasedTrainer" title="robo_orchard_lab.pipeline.hook_based_trainer.HookBasedTrainer"><code class="xref py py-class docutils literal notranslate"><span class="pre">robo_orchard_lab.pipeline.hook_based_trainer.HookBasedTrainer</span></code></a> is the heart of your training loop.
It takes all necessary PyTorch components (model, dataloader, optimizer, scheduler) and crucially,
the accelerator and a batch_processor. The hooks list allows for powerful customization, which we have explored before.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">robo_orchard_lab.pipeline</span> <span class="kn">import</span> <span class="n">HookBasedTrainer</span>

<span class="n">trainer</span> <span class="o">=</span> <span class="n">HookBasedTrainer</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">dataloader</span><span class="o">=</span><a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader" title="torch.utils.data.DataLoader" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">train_dataloader</span></a><span class="p">,</span>
    <a href="https://pytorch.org/docs/stable/generated/torch.optim.SGD.html#torch.optim.SGD" title="torch.optim.SGD" class="sphx-glr-backref-module-torch-optim sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">optimizer</span></a><span class="o">=</span><a href="https://pytorch.org/docs/stable/generated/torch.optim.SGD.html#torch.optim.SGD" title="torch.optim.SGD" class="sphx-glr-backref-module-torch-optim sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">optimizer</span></a><span class="p">,</span>
    <a href="https://pytorch.org/docs/stable/generated/torch.optim.lr_scheduler.StepLR.html#torch.optim.lr_scheduler.StepLR" title="torch.optim.lr_scheduler.StepLR" class="sphx-glr-backref-module-torch-optim-lr_scheduler sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">lr_scheduler</span></a><span class="o">=</span><a href="https://pytorch.org/docs/stable/generated/torch.optim.lr_scheduler.StepLR.html#torch.optim.lr_scheduler.StepLR" title="torch.optim.lr_scheduler.StepLR" class="sphx-glr-backref-module-torch-optim-lr_scheduler sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">lr_scheduler</span></a><span class="p">,</span>
    <span class="n">accelerator</span><span class="o">=</span><span class="n">accelerator</span><span class="p">,</span>
    <span class="n">batch_processor</span><span class="o">=</span><a href="https://docs.python.org/3.10/library/abc.html#abc.ABC" title="abc.ABC" class="sphx-glr-backref-module-abc sphx-glr-backref-type-py-class"><span class="n">MyBatchProcessor</span></a><span class="p">(</span><span class="n">need_backward</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">max_epoch</span><span class="o">=</span><a href="https://docs.python.org/3.10/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cfg</span><span class="o">.</span><span class="n">max_epoch</span></a><span class="p">,</span>
    <a href="https://docs.python.org/3.10/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hooks</span></a><span class="o">=</span><a href="https://docs.python.org/3.10/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hooks</span></a><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Rank[0/1] 05/27/2025 16:39:26 INFO __main__:430 MyHook instance created with step_freq=5, epoch_freq=1
</pre></div>
</div>
<p>Show hooks</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><a href="https://docs.python.org/3.10/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">hooks</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;robo_orchard_lab.pipeline.hooks.mixin.PipelineHooks(
  hooks={
    on_loop: &lt;robo_orchard_core.utils.hook.HookContextChannel(
      name=on_loop,
      hooks=[
        0: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=&lt;FunctionInfo bound method MyMetricTracker(id=140451873746960)._on_loop_begin from ../../robo_orchard_lab/pipeline/hooks/metric.py:181&gt;,
          after=None)&gt;,
        1: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=&lt;FunctionInfo bound method StatsMonitor(id=140451873746144)._on_loop_begin from ../../robo_orchard_lab/pipeline/hooks/stats.py:234&gt;,
          after=None)&gt;,
        2: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=&lt;FunctionInfo bound method MyHook(id=140452168780816)._on_loop_begin from nonb-01_basic_example.py:434&gt;,
          after=&lt;FunctionInfo bound method MyHook(id=140452168780816)._on_loop_end from nonb-01_basic_example.py:437&gt;)&gt;
      ])&gt;,
    on_epoch: &lt;robo_orchard_core.utils.hook.HookContextChannel(
      name=on_epoch,
      hooks=[
        0: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=None,
          after=&lt;FunctionInfo bound method MyMetricTracker(id=140451873746960)._on_epoch_end from ../../robo_orchard_lab/pipeline/hooks/metric.py:233&gt;)&gt;,
        1: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=&lt;FunctionInfo bound method StatsMonitor(id=140451873746144)._on_epoch_begin from ../../robo_orchard_lab/pipeline/hooks/stats.py:316&gt;,
          after=&lt;FunctionInfo bound method StatsMonitor(id=140451873746144)._on_epoch_end from ../../robo_orchard_lab/pipeline/hooks/stats.py:321&gt;)&gt;,
        2: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=None,
          after=&lt;FunctionInfo bound method SaveCheckpoint(id=140451873740960)._on_epoch_end from ../../robo_orchard_lab/pipeline/hooks/checkpoint.py:116&gt;)&gt;,
        3: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=&lt;FunctionInfo bound method MyHook(id=140452168780816)._on_epoch_begin from nonb-01_basic_example.py:449&gt;,
          after=&lt;FunctionInfo bound method MyHook(id=140452168780816)._on_epoch_end from nonb-01_basic_example.py:454&gt;)&gt;
      ])&gt;,
    on_step: &lt;robo_orchard_core.utils.hook.HookContextChannel(
      name=on_step,
      hooks=[
        0: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=None,
          after=&lt;FunctionInfo bound method OptimizerHook(id=140451052833280)._optimizer_step from ../../robo_orchard_lab/pipeline/hooks/optimizer.py:45&gt;)&gt;,
        1: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=None,
          after=&lt;FunctionInfo bound method MyMetricTracker(id=140451873746960)._on_step_end from ../../robo_orchard_lab/pipeline/hooks/metric.py:205&gt;)&gt;,
        2: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=&lt;FunctionInfo bound method StatsMonitor(id=140451873746144)._on_step_begin from ../../robo_orchard_lab/pipeline/hooks/stats.py:245&gt;,
          after=&lt;FunctionInfo bound method StatsMonitor(id=140451873746144)._on_step_end from ../../robo_orchard_lab/pipeline/hooks/stats.py:249&gt;)&gt;,
        3: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=None,
          after=&lt;FunctionInfo bound method SaveCheckpoint(id=140451873740960)._on_step_end from ../../robo_orchard_lab/pipeline/hooks/checkpoint.py:88&gt;)&gt;,
        4: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=&lt;FunctionInfo bound method MyHook(id=140452168780816)._on_step_begin from nonb-01_basic_example.py:440&gt;,
          after=&lt;FunctionInfo bound method MyHook(id=140452168780816)._on_step_end from nonb-01_basic_example.py:445&gt;)&gt;
      ])&gt;,
    on_batch: &lt;robo_orchard_core.utils.hook.HookContextChannel(
      name=on_batch,
      hooks=[
        0: &lt;robo_orchard_core.utils.hook.HookContextFromCallable(
          name=None,
          before=None,
          after=&lt;FunctionInfo bound method MyMetricTracker(id=140451873746960)._on_batch_end from ../../robo_orchard_lab/pipeline/hooks/metric.py:194&gt;)&gt;
      ])&gt;,
  })&gt;
</pre></div>
</div>
<p>Begin training</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">trainer</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Rank[0/1] 05/27/2025 16:39:26 INFO robo_orchard_lab.pipeline.hook_based_trainer:323
==================================================BEGIN TRAINING==================================================
Rank[0/1] 05/27/2025 16:39:26 INFO robo_orchard_lab.pipeline.hook_based_trainer:327 Start training loop from epoch 0 and step 0
Rank[0/1] 05/27/2025 16:39:26 INFO __main__:435 Begining loop
Rank[0/1] 05/27/2025 16:39:26 INFO __main__:452 Begining 0-th epoch
Rank[0/1] 05/27/2025 16:39:29 INFO __main__:443 Begining 4-th step
Rank[0/1] 05/27/2025 16:39:29 INFO __main__:447 Ended 4-th step
Rank[0/1] 05/27/2025 16:39:31 INFO robo_orchard_lab.pipeline.hooks.metric:179 Epoch[0]: top1_acc[tensor(0.0020, device=&#39;cuda:0&#39;)] top5_acc[tensor(0.0049, device=&#39;cuda:0&#39;)]
Rank[0/1] 05/27/2025 16:39:31 INFO robo_orchard_lab.pipeline.hooks.stats:394 Epoch[0] completed. Training Speed: 217.75 samples/sec across all devices. Epoch Time: 4.70 sec.   Average Epoch Time: 4.70 sec.   Average Step Time: 0.59 sec.    Estimated Remaining Time: 0:00:18.      Learning Rate: 1.00000e-01.
Rank[0/1] 05/27/2025 16:39:31 INFO accelerate.accelerator:3022 Saving current state to ./workspace/checkpoints/checkpoint_0
Rank[0/1] 05/27/2025 16:39:31 INFO accelerate.checkpointing:105 Model weights saved in workspace/checkpoints/checkpoint_0/model.safetensors
Rank[0/1] 05/27/2025 16:39:31 INFO accelerate.checkpointing:105 Model weights saved in workspace/checkpoints/checkpoint_0/model_1.safetensors
Rank[0/1] 05/27/2025 16:39:31 INFO accelerate.checkpointing:112 Optimizer state saved in workspace/checkpoints/checkpoint_0/optimizer.bin
Rank[0/1] 05/27/2025 16:39:31 INFO accelerate.checkpointing:119 Scheduler state saved in workspace/checkpoints/checkpoint_0/scheduler.bin
Rank[0/1] 05/27/2025 16:39:31 INFO accelerate.checkpointing:136 Sampler state for dataloader 0 saved in workspace/checkpoints/checkpoint_0/sampler.bin
Rank[0/1] 05/27/2025 16:39:31 INFO accelerate.checkpointing:161 Random states saved in workspace/checkpoints/checkpoint_0/random_states_0.pkl
Rank[0/1] 05/27/2025 16:39:31 INFO accelerate.checkpointing:295 Saving the state of TrainerProgressState to workspace/checkpoints/checkpoint_0/custom_checkpoint_0.pkl
Rank[0/1] 05/27/2025 16:39:31 INFO robo_orchard_lab.pipeline.hooks.checkpoint:137 Save checkpoint at the end of epoch 0 to workspace/checkpoints/checkpoint_0
Rank[0/1] 05/27/2025 16:39:31 INFO __main__:456 Ended 0-th epoch
Rank[0/1] 05/27/2025 16:39:31 INFO __main__:452 Begining 1-th epoch
Rank[0/1] 05/27/2025 16:39:34 INFO __main__:443 Begining 4-th step
Rank[0/1] 05/27/2025 16:39:34 INFO __main__:447 Ended 4-th step
Rank[0/1] 05/27/2025 16:39:36 INFO robo_orchard_lab.pipeline.hooks.metric:179 Epoch[1]: top1_acc[tensor(0.0029, device=&#39;cuda:0&#39;)] top5_acc[tensor(0.0059, device=&#39;cuda:0&#39;)]
Rank[0/1] 05/27/2025 16:39:36 INFO robo_orchard_lab.pipeline.hooks.stats:394 Epoch[1] completed. Training Speed: 221.87 samples/sec across all devices. Epoch Time: 4.62 sec.   Average Epoch Time: 4.62 sec.   Average Step Time: 0.58 sec.    Estimated Remaining Time: 0:00:14.      Learning Rate: 1.00000e-01.
Rank[0/1] 05/27/2025 16:39:36 INFO accelerate.accelerator:3022 Saving current state to ./workspace/checkpoints/checkpoint_1
Rank[0/1] 05/27/2025 16:39:36 INFO accelerate.checkpointing:105 Model weights saved in workspace/checkpoints/checkpoint_1/model.safetensors
Rank[0/1] 05/27/2025 16:39:36 INFO accelerate.checkpointing:105 Model weights saved in workspace/checkpoints/checkpoint_1/model_1.safetensors
Rank[0/1] 05/27/2025 16:39:36 INFO accelerate.checkpointing:112 Optimizer state saved in workspace/checkpoints/checkpoint_1/optimizer.bin
Rank[0/1] 05/27/2025 16:39:36 INFO accelerate.checkpointing:119 Scheduler state saved in workspace/checkpoints/checkpoint_1/scheduler.bin
Rank[0/1] 05/27/2025 16:39:36 INFO accelerate.checkpointing:136 Sampler state for dataloader 0 saved in workspace/checkpoints/checkpoint_1/sampler.bin
Rank[0/1] 05/27/2025 16:39:36 INFO accelerate.checkpointing:161 Random states saved in workspace/checkpoints/checkpoint_1/random_states_0.pkl
Rank[0/1] 05/27/2025 16:39:36 INFO accelerate.checkpointing:295 Saving the state of TrainerProgressState to workspace/checkpoints/checkpoint_1/custom_checkpoint_0.pkl
Rank[0/1] 05/27/2025 16:39:36 INFO robo_orchard_lab.pipeline.hooks.checkpoint:137 Save checkpoint at the end of epoch 1 to workspace/checkpoints/checkpoint_1
Rank[0/1] 05/27/2025 16:39:36 INFO __main__:456 Ended 1-th epoch
Rank[0/1] 05/27/2025 16:39:36 INFO __main__:452 Begining 2-th epoch
Rank[0/1] 05/27/2025 16:39:39 INFO __main__:443 Begining 4-th step
Rank[0/1] 05/27/2025 16:39:39 INFO __main__:447 Ended 4-th step
Rank[0/1] 05/27/2025 16:39:41 INFO robo_orchard_lab.pipeline.hooks.metric:179 Epoch[2]: top1_acc[tensor(0.0039, device=&#39;cuda:0&#39;)] top5_acc[tensor(0.0107, device=&#39;cuda:0&#39;)]
Rank[0/1] 05/27/2025 16:39:41 INFO robo_orchard_lab.pipeline.hooks.stats:394 Epoch[2] completed. Training Speed: 215.89 samples/sec across all devices. Epoch Time: 4.74 sec.   Average Epoch Time: 4.74 sec.   Average Step Time: 0.59 sec.    Estimated Remaining Time: 0:00:09.      Learning Rate: 1.00000e-01.
Rank[0/1] 05/27/2025 16:39:41 INFO accelerate.accelerator:3022 Saving current state to ./workspace/checkpoints/checkpoint_2
Rank[0/1] 05/27/2025 16:39:41 INFO accelerate.checkpointing:105 Model weights saved in workspace/checkpoints/checkpoint_2/model.safetensors
Rank[0/1] 05/27/2025 16:39:41 INFO accelerate.checkpointing:105 Model weights saved in workspace/checkpoints/checkpoint_2/model_1.safetensors
Rank[0/1] 05/27/2025 16:39:41 INFO accelerate.checkpointing:112 Optimizer state saved in workspace/checkpoints/checkpoint_2/optimizer.bin
Rank[0/1] 05/27/2025 16:39:41 INFO accelerate.checkpointing:119 Scheduler state saved in workspace/checkpoints/checkpoint_2/scheduler.bin
Rank[0/1] 05/27/2025 16:39:41 INFO accelerate.checkpointing:136 Sampler state for dataloader 0 saved in workspace/checkpoints/checkpoint_2/sampler.bin
Rank[0/1] 05/27/2025 16:39:41 INFO accelerate.checkpointing:161 Random states saved in workspace/checkpoints/checkpoint_2/random_states_0.pkl
Rank[0/1] 05/27/2025 16:39:41 INFO accelerate.checkpointing:295 Saving the state of TrainerProgressState to workspace/checkpoints/checkpoint_2/custom_checkpoint_0.pkl
Rank[0/1] 05/27/2025 16:39:41 INFO robo_orchard_lab.pipeline.hooks.checkpoint:137 Save checkpoint at the end of epoch 2 to workspace/checkpoints/checkpoint_2
Rank[0/1] 05/27/2025 16:39:41 INFO __main__:456 Ended 2-th epoch
Rank[0/1] 05/27/2025 16:39:41 INFO __main__:452 Begining 3-th epoch
Rank[0/1] 05/27/2025 16:39:44 INFO __main__:443 Begining 4-th step
Rank[0/1] 05/27/2025 16:39:44 INFO __main__:447 Ended 4-th step
Rank[0/1] 05/27/2025 16:39:46 INFO robo_orchard_lab.pipeline.hooks.metric:179 Epoch[3]: top1_acc[tensor(0.0020, device=&#39;cuda:0&#39;)] top5_acc[tensor(0.0117, device=&#39;cuda:0&#39;)]
Rank[0/1] 05/27/2025 16:39:46 INFO robo_orchard_lab.pipeline.hooks.stats:394 Epoch[3] completed. Training Speed: 211.40 samples/sec across all devices. Epoch Time: 4.84 sec.   Average Epoch Time: 4.84 sec.   Average Step Time: 0.61 sec.    Estimated Remaining Time: 0:00:04.      Learning Rate: 1.00000e-02.
Rank[0/1] 05/27/2025 16:39:46 INFO accelerate.accelerator:3022 Saving current state to ./workspace/checkpoints/checkpoint_3
Rank[0/1] 05/27/2025 16:39:46 INFO accelerate.checkpointing:105 Model weights saved in workspace/checkpoints/checkpoint_3/model.safetensors
Rank[0/1] 05/27/2025 16:39:46 INFO accelerate.checkpointing:105 Model weights saved in workspace/checkpoints/checkpoint_3/model_1.safetensors
Rank[0/1] 05/27/2025 16:39:46 INFO accelerate.checkpointing:112 Optimizer state saved in workspace/checkpoints/checkpoint_3/optimizer.bin
Rank[0/1] 05/27/2025 16:39:46 INFO accelerate.checkpointing:119 Scheduler state saved in workspace/checkpoints/checkpoint_3/scheduler.bin
Rank[0/1] 05/27/2025 16:39:46 INFO accelerate.checkpointing:136 Sampler state for dataloader 0 saved in workspace/checkpoints/checkpoint_3/sampler.bin
Rank[0/1] 05/27/2025 16:39:46 INFO accelerate.checkpointing:161 Random states saved in workspace/checkpoints/checkpoint_3/random_states_0.pkl
Rank[0/1] 05/27/2025 16:39:46 INFO accelerate.checkpointing:295 Saving the state of TrainerProgressState to workspace/checkpoints/checkpoint_3/custom_checkpoint_0.pkl
Rank[0/1] 05/27/2025 16:39:46 INFO robo_orchard_lab.pipeline.hooks.checkpoint:137 Save checkpoint at the end of epoch 3 to workspace/checkpoints/checkpoint_3
Rank[0/1] 05/27/2025 16:39:46 INFO __main__:456 Ended 3-th epoch
Rank[0/1] 05/27/2025 16:39:46 INFO __main__:452 Begining 4-th epoch
Rank[0/1] 05/27/2025 16:39:49 INFO __main__:443 Begining 4-th step
Rank[0/1] 05/27/2025 16:39:49 INFO __main__:447 Ended 4-th step
Rank[0/1] 05/27/2025 16:39:50 INFO robo_orchard_lab.pipeline.hooks.metric:179 Epoch[4]: top1_acc[tensor(0.0059, device=&#39;cuda:0&#39;)] top5_acc[tensor(0.0186, device=&#39;cuda:0&#39;)]
Rank[0/1] 05/27/2025 16:39:50 INFO robo_orchard_lab.pipeline.hooks.stats:394 Epoch[4] completed. Training Speed: 222.33 samples/sec across all devices. Epoch Time: 4.61 sec.   Average Epoch Time: 4.61 sec.   Average Step Time: 0.58 sec.    Estimated Remaining Time: 0:00:00.      Learning Rate: 1.00000e-02.
Rank[0/1] 05/27/2025 16:39:50 INFO accelerate.accelerator:3022 Saving current state to ./workspace/checkpoints/checkpoint_4
Rank[0/1] 05/27/2025 16:39:51 INFO accelerate.checkpointing:105 Model weights saved in workspace/checkpoints/checkpoint_4/model.safetensors
Rank[0/1] 05/27/2025 16:39:51 INFO accelerate.checkpointing:105 Model weights saved in workspace/checkpoints/checkpoint_4/model_1.safetensors
Rank[0/1] 05/27/2025 16:39:51 INFO accelerate.checkpointing:112 Optimizer state saved in workspace/checkpoints/checkpoint_4/optimizer.bin
Rank[0/1] 05/27/2025 16:39:51 INFO accelerate.checkpointing:119 Scheduler state saved in workspace/checkpoints/checkpoint_4/scheduler.bin
Rank[0/1] 05/27/2025 16:39:51 INFO accelerate.checkpointing:136 Sampler state for dataloader 0 saved in workspace/checkpoints/checkpoint_4/sampler.bin
Rank[0/1] 05/27/2025 16:39:51 INFO accelerate.checkpointing:161 Random states saved in workspace/checkpoints/checkpoint_4/random_states_0.pkl
Rank[0/1] 05/27/2025 16:39:51 INFO accelerate.checkpointing:295 Saving the state of TrainerProgressState to workspace/checkpoints/checkpoint_4/custom_checkpoint_0.pkl
Rank[0/1] 05/27/2025 16:39:51 INFO robo_orchard_lab.pipeline.hooks.checkpoint:137 Save checkpoint at the end of epoch 4 to workspace/checkpoints/checkpoint_4
Rank[0/1] 05/27/2025 16:39:51 INFO __main__:456 Ended 4-th epoch
Rank[0/1] 05/27/2025 16:39:51 INFO __main__:438 Ended loop
Rank[0/1] 05/27/2025 16:39:51 INFO robo_orchard_lab.pipeline.hook_based_trainer:396
==================================================FINISH TRAINING==================================================
</pre></div>
</div>
<p>All the checkpoints is saved to <code class="docutils literal notranslate"><span class="pre">cfg.workspace</span></code></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="nb">print</span><span class="p">(</span><a href="https://docs.python.org/3.10/library/subprocess.html#subprocess.check_output" title="subprocess.check_output" class="sphx-glr-backref-module-subprocess sphx-glr-backref-type-py-function"><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span></a><span class="p">([</span><span class="s2">&quot;tree&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3.10/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cfg</span><span class="o">.</span><span class="n">workspace_root</span></a><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>./workspace/
└── checkpoints
    ├── checkpoint_0
    │   ├── custom_checkpoint_0.pkl
    │   ├── model_1.safetensors
    │   ├── model.safetensors
    │   ├── optimizer.bin
    │   ├── random_states_0.pkl
    │   └── scheduler.bin
    ├── checkpoint_1
    │   ├── custom_checkpoint_0.pkl
    │   ├── model_1.safetensors
    │   ├── model.safetensors
    │   ├── optimizer.bin
    │   ├── random_states_0.pkl
    │   └── scheduler.bin
    ├── checkpoint_2
    │   ├── custom_checkpoint_0.pkl
    │   ├── model_1.safetensors
    │   ├── model.safetensors
    │   ├── optimizer.bin
    │   ├── random_states_0.pkl
    │   └── scheduler.bin
    ├── checkpoint_3
    │   ├── custom_checkpoint_0.pkl
    │   ├── model_1.safetensors
    │   ├── model.safetensors
    │   ├── optimizer.bin
    │   ├── random_states_0.pkl
    │   └── scheduler.bin
    └── checkpoint_4
        ├── custom_checkpoint_0.pkl
        ├── model_1.safetensors
        ├── model.safetensors
        ├── optimizer.bin
        ├── random_states_0.pkl
        └── scheduler.bin

6 directories, 30 files
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 25.395 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-build-trainer-tutorial-nonb-01-basic-example-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/4280948d0913a2e42933717b500f6b46/nonb-01_basic_example.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">nonb-01_basic_example.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/253b608fd6a744a8b8eb744efeef09e3/nonb-01_basic_example.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">nonb-01_basic_example.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/1ab334e490c6a025cecd614809b11617/nonb-01_basic_example.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">nonb-01_basic_example.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../api/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Trainer Tutorials</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Horizon Robotics Developers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/HorizonRobotics/robo_orchard_lab" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Mastering Your Training Pipeline</a><ul>
<li><a class="reference internal" href="#prerequest-import-packages-and-configure-logging">Prerequest: Import packages and configure logging</a></li>
<li><a class="reference internal" href="#part1-using-pydantic-for-configuration">Part1: Using pydantic for configuration</a></li>
<li><a class="reference internal" href="#part2-understanding-the-core-trainer-components">Part2: Understanding the Core trainer Components</a><ul>
<li><a class="reference internal" href="#accelerator-the-engine-for-scale-and-simplicity">Accelerator: The Engine for Scale and Simplicity</a></li>
<li><a class="reference internal" href="#batch-processor-defining-per-step-logic">Batch processor: Defining Per-Step Logic</a></li>
<li><a class="reference internal" href="#hooks-customizing-your-pipeline">Hooks: Customizing your pipeline</a><ul>
<li><a class="reference internal" href="#metrictracker-track-on-performance">MetricTracker: Track on performance</a></li>
<li><a class="reference internal" href="#statsmonitor-logging-training-vitals">StatsMonitor: Logging Training Vitals</a></li>
<li><a class="reference internal" href="#savecheckpoint-saving-your-progress">SaveCheckpoint: Saving Your Progress</a></li>
<li><a class="reference internal" href="#advanced-creating-your-first-custom-hook">(Advanced) Creating Your First Custom Hook</a><ul>
<li><a class="reference internal" href="#implementing-the-custom-hook-myhook">Implementing the Custom Hook: <code class="docutils literal notranslate"><span class="pre">MyHook</span></code></a></li>
<li><a class="reference internal" href="#defining-your-custom-hook-configuration">Defining Your Custom Hook Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#dataloader-model-optimizer-and-learning-rate-scheduler">DataLoader, model, optimizer and learning rate scheduler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#part3-orchestrating-the-training">Part3: Orchestrating the Training</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=38b66d78"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/google_analytics.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>